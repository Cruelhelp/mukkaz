<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' data: https://fonts.gstatic.com; img-src 'self' data: https: blob:; media-src 'self' blob: https:; connect-src 'self' https://*.supabase.co https://cdn.jsdelivr.net; frame-src 'none'; object-src 'none'; base-uri 'self';">
  <title>Upload Video - Mukkaz</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <script src="config.local.js" onerror="console.warn('config.local.js not found - using defaults')"></script>
  <script src="config.js"></script>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    .upload-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
      position: relative;
    }

    .upload-steps::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--border-color);
      z-index: 0;
    }

    .step {
      flex: 1;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .step-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--bg-tertiary);
      border: 2px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 0.5rem;
      font-weight: bold;
      transition: all 0.3s;
    }

    .step.active .step-circle {
      background: var(--accent-red);
      border-color: var(--accent-red);
      color: white;
    }

    .step.complete .step-circle {
      background: var(--accent-green);
      border-color: var(--accent-green);
      color: white;
    }

    .video-preview-container {
      background: var(--bg-black);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .video-preview {
      width: 100%;
      max-height: 400px;
      border-radius: 4px;
    }

    .video-controls {
      margin-top: 1rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: 4px;
    }

    .trim-control {
      margin: 1rem 0;
    }

    .trim-slider {
      width: 100%;
      -webkit-appearance: none;
      height: 6px;
      border-radius: 3px;
      background: var(--bg-tertiary);
      outline: none;
    }

    .trim-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--accent-red);
      cursor: pointer;
    }

    .trim-slider::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--accent-red);
      cursor: pointer;
      border: none;
    }

    .thumbnail-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .thumbnail-option {
      position: relative;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 4px;
      overflow: hidden;
      transition: all 0.2s;
    }

    .thumbnail-option:hover {
      border-color: var(--accent-blue);
      transform: scale(1.05);
    }

    .thumbnail-option.selected {
      border-color: var(--accent-red);
      box-shadow: 0 0 10px rgba(204, 0, 0, 0.5);
    }

    .thumbnail-option img {
      width: 100%;
      height: 100px;
      object-fit: cover;
    }

    .thumbnail-time {
      position: absolute;
      bottom: 4px;
      right: 4px;
      background: rgba(0, 0, 0, 0.8);
      padding: 2px 6px;
      border-radius: 2px;
      font-size: 0.75rem;
    }

    .progress-container {
      background: var(--bg-secondary);
      padding: 2rem;
      border-radius: 8px;
      margin-top: 2rem;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-red), #FF4444);
      transition: width 0.3s ease;
      width: 0%;
    }

    .progress-stages {
      margin-top: 1.5rem;
    }

    .progress-stage {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.5rem 0;
    }

    .stage-status {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
    }

    .stage-status.pending {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
    }

    .stage-status.in_progress {
      background: var(--accent-blue);
      animation: pulse 1.5s infinite;
    }

    .stage-status.complete {
      background: var(--accent-green);
    }

    .stage-status.error {
      background: var(--accent-red);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .step-content {
      display: none;
    }

    .step-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="navbar-left">
      <button class="nav-icon hamburger-btn" id="hamburgerBtn">
        <span id="hamburgerIcon"></span>
      </button>
      <a href="index.html" class="logo">
        <img src="logo.png" alt="Mukkaz" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="navbar-center">
      <div class="search-container">
        <input type="text" class="search-input" id="searchInput" placeholder="Search videos...">
        <button class="search-btn" id="searchBtn">
          <span id="searchIcon"></span>
        </button>
      </div>
    </div>

    <div class="navbar-right" id="navbarRight"></div>
  </nav>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-section">
      <a href="index.html" class="sidebar-item">
        <span id="homeIcon"></span>
        <span>Home</span>
      </a>
      <a href="#trending" class="sidebar-item">
        <span id="trendingIcon"></span>
        <span>Trending</span>
      </a>
    </div>
    <div class="sidebar-section" id="authSection"></div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <div class="upload-container">
      <h2 class="page-title">Upload Video</h2>

      <!-- Upload Steps -->
      <div class="upload-steps">
        <div class="step active" id="step1">
          <div class="step-circle">1</div>
          <div>Select Video</div>
        </div>
        <div class="step" id="step2">
          <div class="step-circle">2</div>
          <div>Edit & Preview</div>
        </div>
        <div class="step" id="step3">
          <div class="step-circle">3</div>
          <div>Details</div>
        </div>
        <div class="step" id="step4">
          <div class="step-circle">4</div>
          <div>Upload</div>
        </div>
      </div>

      <!-- Step 1: Select Video -->
      <div class="step-content active" id="stepContent1">
        <div class="file-upload-area" id="videoUploadArea">
          <div class="upload-icon" id="uploadIcon"></div>
          <p>Click or drag video file to upload</p>
          <p class="secondary" style="font-size: 0.85rem; margin-top: 0.5rem;">
            MP4, WebM, or AVI (Max 100MB)
          </p>
        </div>
        <input type="file" id="videoFileInput" class="file-input" accept="video/*" required>
        <div class="file-info hidden" id="videoFileInfo"></div>
      </div>

      <!-- Step 2: Edit & Preview -->
      <div class="step-content" id="stepContent2">
        <div class="video-preview-container">
          <video id="videoPreview" class="video-preview" controls></video>

          <div class="video-controls">
            <h3 style="margin-bottom: 1rem;">Video Controls</h3>

            <!-- Trim Controls -->
            <div class="trim-control">
              <label class="form-label">Trim Video (Optional)</label>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 0.5rem;">
                <div>
                  <label class="secondary" style="font-size: 0.85rem;">Start: <span id="trimStartTime">0:00</span></label>
                  <input type="range" class="trim-slider" id="trimStartSlider" min="0" max="100" value="0">
                </div>
                <div>
                  <label class="secondary" style="font-size: 0.85rem;">End: <span id="trimEndTime">0:00</span></label>
                  <input type="range" class="trim-slider" id="trimEndSlider" min="0" max="100" value="100">
                </div>
              </div>
              <p class="secondary" style="font-size: 0.85rem; margin-top: 0.5rem;">
                Duration: <span id="trimDuration">0:00</span>
              </p>
            </div>
          </div>
        </div>

        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
          <button class="btn-secondary" onclick="goToStep(1)">Back</button>
          <button class="btn-primary" onclick="goToStep(3)">Next</button>
        </div>
      </div>

      <!-- Step 3: Thumbnail & Details -->
      <div class="step-content" id="stepContent3">
        <h3 style="margin-bottom: 1rem;">Choose Thumbnail</h3>
        <p class="secondary" style="margin-bottom: 1rem;">Select a frame or upload custom</p>

        <div class="thumbnail-options" id="thumbnailOptions"></div>

        <div style="margin-top: 1.5rem;">
          <button class="btn-secondary" id="uploadCustomThumbnail">
            Upload Custom Thumbnail
          </button>
          <input type="file" id="customThumbnailInput" class="file-input" accept="image/*">
        </div>

        <div style="margin-top: 2rem;">
          <div class="form-group">
            <label class="form-label">Title *</label>
            <input type="text" class="form-input" id="videoTitle" placeholder="Enter video title" required maxlength="100">
          </div>

          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="videoDescription" placeholder="Tell viewers about your video" maxlength="500"></textarea>
          </div>
        </div>

        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
          <button class="btn-secondary" onclick="goToStep(2)">Back</button>
          <button class="btn-primary" onclick="goToStep(4)">Next</button>
        </div>
      </div>

      <!-- Step 4: Upload Progress -->
      <div class="step-content" id="stepContent4">
        <div class="progress-container hidden" id="uploadProgressContainer">
          <h3>Uploading your video...</h3>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div style="text-align: center; margin: 1rem 0;">
            <span id="overallProgress">0%</span>
          </div>

          <div class="progress-stages" id="progressStages"></div>
        </div>

        <div id="uploadSummary">
          <h3 style="margin-bottom: 1rem;">Ready to Upload</h3>
          <div id="summaryContent" style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 8px;"></div>

          <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button class="btn-secondary" onclick="goToStep(3)">Back</button>
            <button class="btn-primary" id="finalUploadBtn">Upload Video</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="icons.js"></script>
  <script src="utils.js"></script>
  <script src="supabase.js"></script>
  <script src="app.js"></script>
  <script src="video-editor.js"></script>
  <script src="upload-enhanced-logic.js"></script>
</body>
</html>
