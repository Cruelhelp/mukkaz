<!DOCTYPE html>
<html lang="en">
<head>  <meta charset="UTF-8">  <meta name="viewport" content="width=device-width, initial-scale=1.0">  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net https://pl28394065.effectivegatecpm.com https://pl28394078.effectivegatecpm.com https://va.vercel-scripts.com https://cdn.growthbook.io; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' data: https://fonts.gstatic.com; img-src 'self' data: https: blob:; media-src 'self' blob: https: https://videodelivery.net https://cloudflarestream.com; connect-src 'self' https://*.supabase.co https://api.ipify.org https://cdn.jsdelivr.net https://api.cloudflare.com https://videodelivery.net https://embed.cloudflarestream.com https://vitals.vercel-insights.com https://cdn.growthbook.io; frame-src 'self' https://embed.cloudflarestream.com https://iframe.videodelivery.net; worker-src 'self' blob:; child-src 'self' blob:; object-src 'none'; base-uri 'self';">  <title>Profile - Mukkaz</title>  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">  <script src="js/config.local.js" onerror="console.warn('config.local.js not found - using defaults')"></script>  <script src="js/config.js"></script>  <link rel="stylesheet" href="css/styles.css">  <link rel="stylesheet" href="css/youtube-redesign.css">  <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">  <script src="js/age-gate.js"></script>  <script src="js/components.js"></script>  <script src="js/analytics.js"></script>  <script src="js/growthbook.js"></script></head>
<body>  <!-- Navigation Bar -->  <nav class="navbar">    <div class="navbar-left">      <button class="nav-icon hamburger-btn" id="hamburgerBtn">        <span id="hamburgerIcon">
</span>      </button>      <a href="index.html" class="logo">        <img src="assets/logo.png" alt="Mukkaz" onerror="this.style.display='none'">      </a>    </div>    <div class="navbar-center">      <div class="search-container">        <input          type="text"          class="search-input"          id="searchInput"          placeholder="Search videos..."          autocomplete="off"        >        <button class="search-btn" id="searchBtn">          <span id="searchIcon">
</span>        </button>        <div class="search-suggestions hidden" id="searchSuggestions">          <!-- Tag suggestions populated by JavaScript -->        </div>      </div>    </div>    <div class="navbar-right" id="navbarRight">      <!-- Loading skeleton -->      <div class="navbar-skeleton" id="navbarSkeleton">        <div class="skeleton-nav-icon">
</div>        <div class="skeleton-nav-icon">
</div>        <div class="skeleton-avatar">
</div>      </div>    </div>  </nav>  <!-- Sidebar -->  <aside class="sidebar" id="sidebar">    <!-- Home, Trending & History Section -->    <div class="sidebar-section">      <a href="index.html" class="sidebar-item">        <span id="homeIcon">
</span>        <span>Home</span>      </a>      <a href="index.html#trending" class="sidebar-item">        <span id="trendingIcon">
</span>        <span>Trending</span>      </a>      <a href="history.html" class="sidebar-item">        <span id="historyIcon">
</span>        <span>History</span>      </a>    </div>    <!-- Subscriptions Section -->    <div class="sidebar-section" id="subscriptionsSidebarSection">      <div class="sidebar-section-header">        <span id="subscriptionsIcon">
</span>        <span>Subscriptions</span>      </div>      <div id="subscriptionsList">        <!-- Subscriptions loaded by JavaScript -->      </div>    </div>  </aside>  <!-- Main Content -->  <main class="main-content">    <div class="profile-container">      <!-- Profile Header -->      <div class="profile-header">        <div style="position: relative;">          <div class="profile-avatar-container loading avatar-badge-wrapper" id="profileAvatarContainer">            <img src="" alt="Avatar" id="profileAvatar">          </div>          <input type="file" id="avatarInput" class="file-input" accept="image/*">        </div>        <div class="profile-info">          <h1 class="profile-username" id="profileUsername">Loading...</h1>          <div class="profile-stats">            <span id="videoCount">0 videos</span>            <span>•</span>            <span id="totalViews">0 views</span>            <span>•</span>            <span>Joined <span id="joinedDate">recently</span>
</span>          </div>          <button class="btn-secondary edit-profile-btn" id="editAvatarBtn">            <span id="editIcon">
</span>            Change Avatar          </button>        </div>      </div>      <!-- Profile Tabs -->      <div class="profile-tabs">        <button class="profile-tab active" data-tab="settings">          <span id="settingsIcon">
</span> Settings        </button>        <button class="profile-tab" data-tab="stats">          <span id="statsIcon">
</span> Statistics        </button>        <button class="profile-tab" data-tab="earnings">          <span id="earningsIcon">
</span> Earnings        </button>        <button class="profile-tab" data-tab="privacy">          <span id="privacyIcon">
</span> Privacy        </button>        <button class="profile-tab" data-tab="blocked">          <span id="blockedIcon">
</span> Block List        </button>      </div>      <!-- Settings Sections -->      <div class="profile-settings" id="settingsTab">        <!-- Account Information -->        <div class="settings-section" data-section="account">          <h2 class="settings-title">Account Information</h2>          <div class="settings-item">            <div class="settings-item-header">              <div>                <label class="settings-label">Username</label>                <p class="settings-value" id="displayUsername">Loading...</p>              </div>              <button class="btn-secondary btn-sm" id="editUsernameBtn">Edit</button>            </div>            <form class="settings-form hidden" id="usernameForm">              <input type="text" class="form-input" id="newUsername" placeholder="Enter new username" required>              <div class="form-actions">                <button type="submit" class="btn-primary btn-sm">Save</button>                <button type="button" class="btn-secondary btn-sm" id="cancelUsernameBtn">Cancel</button>              </div>            </form>          </div>          <div class="settings-item">            <div class="settings-item-header">              <div>                <label class="settings-label">Email</label>                <p class="settings-value" id="displayEmail">Loading...</p>              </div>              <button class="btn-secondary btn-sm" id="editEmailBtn">Edit</button>            </div>            <form class="settings-form hidden" id="emailForm">              <input type="email" class="form-input" id="newEmail" placeholder="Enter new email" required>              <div class="form-actions">                <button type="submit" class="btn-primary btn-sm">Save</button>                <button type="button" class="btn-secondary btn-sm" id="cancelEmailBtn">Cancel</button>              </div>            </form>          </div>          <div class="settings-item">            <div class="settings-item-header">              <div>                <label class="settings-label">Password</label>                <p class="settings-value">••••••••</p>              </div>              <button class="btn-secondary btn-sm" id="editPasswordBtn">Change</button>            </div>            <form class="settings-form hidden" id="passwordForm">              <input type="password" class="form-input" id="currentPassword" placeholder="Current password" required>              <input type="password" class="form-input" id="newPassword" placeholder="New password" required>              <input type="password" class="form-input" id="confirmPassword" placeholder="Confirm new password" required>              <div class="form-actions">                <button type="submit" class="btn-primary btn-sm">Update Password</button>                <button type="button" class="btn-secondary btn-sm" id="cancelPasswordBtn">Cancel</button>              </div>            </form>          </div>        </div>        <!-- Privacy & Preferences -->        <div class="settings-section" data-section="privacy">          <h2 class="settings-title">Privacy & Preferences</h2>          <div class="settings-item">            <label class="settings-checkbox">              <input type="checkbox" id="profileVisibilityCheck">              <span>Make profile public</span>            </label>            <p class="settings-hint">Allow others to view your profile and videos</p>          </div>          <div class="settings-item">            <label class="settings-checkbox">              <input type="checkbox" id="showEmailCheck">              <span>Show email on profile</span>            </label>            <p class="settings-hint">Display your email address publicly</p>          </div>          <div class="settings-item">            <label class="settings-checkbox">              <input type="checkbox" id="matureContentCheck" checked>              <span>Show mature content</span>            </label>            <p class="settings-hint">Display age-restricted videos in your feed</p>          </div>        </div>        <!-- Notification Settings -->        <div class="settings-section" data-section="notifications">          <h2 class="settings-title">Notification Settings</h2>          <div class="settings-item">            <label class="settings-checkbox">              <input type="checkbox" id="notifySubscribersCheck" checked>              <span>Notify me when someone subscribes</span>            </label>          </div>          <div class="settings-item">            <label class="settings-checkbox">              <input type="checkbox" id="notifyCommentsCheck" checked>              <span>Notify me when someone comments on my video</span>            </label>          </div>          <div class="settings-item">            <label class="settings-checkbox">              <input type="checkbox" id="notifyLikesCheck">              <span>Notify me when someone likes my video</span>            </label>          </div>          <div class="settings-item">            <label class="settings-checkbox">              <input type="checkbox" id="notifyUploadsCheck" checked>              <span>Notify me when subscribed channels upload</span>            </label>          </div>        </div>        <!-- Statistics -->        <div class="settings-section" data-section="stats">          <h2 class="settings-title">Account Statistics</h2>          <div class="stats-graph-card">            <div class="stats-graph-header">              <div>                <div class="stats-graph-title" id="statsGraphTitle">Total Views</div>                <div class="stats-graph-sub" id="statsGraphSub">Last 12 updates</div>              </div>              <div class="stats-graph-value" id="statsGraphValue">0</div>            </div>            <div class="stats-graph-chart" id="statsGraphChart">
</div>            <div class="stats-graph-pills" id="statsGraphPills">              <button class="stats-pill active" data-stat="views">Views</button>              <button class="stats-pill" data-stat="likes">Likes</button>              <button class="stats-pill" data-stat="videos">Uploads</button>              <button class="stats-pill" data-stat="subs">Subs</button>            </div>          </div>        </div>        <!-- Earnings -->        <div class="settings-section" data-section="earnings">          <h2 class="settings-title">Creator Earnings</h2>          <div class="earnings-dashboard">            <div class="earnings-hero">              <div class="earnings-hero-header">                <div>                  <div class="earnings-hero-title">Earnings Overview</div>                  <div class="earnings-hero-caption">Auto-updates as views count in</div>                </div>                <div class="earnings-hero-badge" id="earningsHeroBadge">Available</div>              </div>              <div class="earnings-hero-value" id="earningsHeroValue">JMD 0</div>              <div class="earnings-hero-sub" id="earningsHeroSub">0 eligible views</div>              <div class="earnings-hero-pills" id="earningsHeroPills">                <button class="earnings-pill active" data-key="available">Available</button>                <button class="earnings-pill" data-key="total">Total Earned</button>                <button class="earnings-pill" data-key="paid">Paid Out</button>                <button class="earnings-pill" data-key="views">Eligible Views</button>              </div>            </div>            <div class="earnings-breakdown">              <div class="earnings-bar" role="img" aria-label="Earnings breakdown bar">                <div class="earnings-bar-seg paid" id="earningsBarPaid">
</div>                <div class="earnings-bar-seg pending" id="earningsBarPending">
</div>                <div class="earnings-bar-seg available" id="earningsBarAvailable">
</div>              </div>              <div class="earnings-bar-legend">                <span>
<span class="earnings-dot paid">
</span>Paid</span>                <span>
<span class="earnings-dot pending">
</span>Pending</span>                <span>
<span class="earnings-dot available">
</span>Available</span>              </div>            </div>            <div class="earnings-mini-grid">              <div class="earnings-mini">                <div class="earnings-mini-value" id="earningsViews">0</div>                <div class="earnings-mini-label">Eligible Views</div>              </div>              <div class="earnings-mini">                <div class="earnings-mini-value" id="earningsTotal">JMD 0</div>                <div class="earnings-mini-label">Total Earned</div>              </div>              <div class="earnings-mini">                <div class="earnings-mini-value" id="earningsPaid">JMD 0</div>                <div class="earnings-mini-label">Paid Out</div>              </div>              <div class="earnings-mini">                <div class="earnings-mini-value" id="earningsAvailable">JMD 0</div>                <div class="earnings-mini-label">Available</div>              </div>            </div>          </div>          <div style="margin-top: 1.5rem; background: var(--bg-secondary); border-radius: 12px; padding: 1rem;">            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">              <strong>Payout Eligibility</strong>              <span id="earningsProgressText">0 / 1000 views</span>            </div>            <div style="background: rgba(255,255,255,0.08); border-radius: 999px; height: 8px; overflow: hidden;">              <div id="earningsProgressBar" style="height: 100%; width: 0%; background: var(--accent-red);">
</div>            </div>            <p class="settings-hint" style="margin-top: 0.75rem;">              You earn <strong>JMD $1 for every 2 valid views</strong>. Payouts unlock at <strong>JMD $1,000 earned</strong>.            </p>          </div>          <div style="margin-top: 1.5rem; background: var(--bg-secondary); border-radius: 12px; padding: 1rem;">            <h3 style="margin: 0 0 0.75rem;">How earnings work</h3>            <div class="earnings-infographic">              <div class="earnings-info-steps">                <div class="earnings-info-card">                  <div class="earnings-info-pill">1</div>                  <div class="earnings-info-title">Eligible views</div>                  <div class="earnings-info-text">1 unique viewer per 24h = 1 eligible view</div>                </div>                <div class="earnings-info-card">                  <div class="earnings-info-pill">2</div>                  <div class="earnings-info-title">Views to money</div>                  <div class="earnings-info-text">Every 2 eligible views earns</div>                  <div class="earnings-info-value">JMD $1</div>                </div>                <div class="earnings-info-card">                  <div class="earnings-info-pill">3</div>                  <div class="earnings-info-title">Payout threshold</div>                  <div class="earnings-info-text">Request payout when you reach</div>                  <div class="earnings-info-value">JMD $1,000</div>                </div>              </div>              <div class="earnings-info-example">                <div class="earnings-info-title">Example</div>                <div class="earnings-info-text">2,400 eligible views = JMD $1,200 earned - payout unlocked</div>              </div>            </div>
<div style="margin-top: 1.5rem; background: var(--bg-secondary); border-radius: 12px; padding: 1rem;">            <h3 style="margin: 0 0 0.75rem;">Request Payout</h3>            <div class="settings-item">              <label class="settings-label">Payout Method</label>              <select class="form-input" id="payoutMethod">                <option value="lynk">Lynk</option>                <option value="crypto">Crypto</option>                <option value="bank">Bank Transfer</option>              </select>            </div>            <div class="settings-item payout-field" data-method="lynk">              <label class="settings-label">Lynk @ID</label>              <input type="text" class="form-input" id="payoutLynkId" placeholder="@yourname">            </div>            <div class="settings-item payout-field" data-method="crypto">              <label class="settings-label">Crypto Type</label>              <select class="form-input" id="payoutCryptoType">                <option value="BTC">Bitcoin (BTC)</option>                <option value="ETH">Ethereum (ETH)</option>                <option value="USDT">Tether (USDT)</option>                <option value="SOL">Solana (SOL)</option>              </select>            </div>            <div class="settings-item payout-field" data-method="crypto">              <label class="settings-label">Wallet Address</label>              <input type="text" class="form-input" id="payoutCryptoAddress" placeholder="0x... or wallet address">            </div>            <div class="settings-item payout-field" data-method="bank">              <label class="settings-label">Account Type</label>              <select class="form-input" id="payoutBankType">                <option value="savings">Savings</option>                <option value="chequing">Chequing</option>              </select>            </div>            <div class="settings-item payout-field" data-method="bank">              <label class="settings-label">Bank Branch</label>              <input type="text" class="form-input" id="payoutBankBranch" placeholder="Branch name or code">            </div>            <div class="settings-item payout-field" data-method="bank">              <label class="settings-label">Account Number</label>              <input type="text" class="form-input" id="payoutBankAccount" placeholder="Account number">            </div>            <button class="btn-primary btn-sm" id="requestPayoutBtn">Request Payout</button>            <p class="settings-hint" id="payoutHint">Need JMD 1,000 earned to request a payout.</p>          </div>          <div style="margin-top: 1.5rem;">            <h3 style="margin-bottom: 0.5rem;">Payout Requests</h3>            <div id="payoutRequestsList" class="settings-hint">No payout requests yet.</div>          </div>        </div>        <!-- Block List -->        <div class="settings-section" data-section="blocked">          <h2 class="settings-title">Hidden Videos</h2>          <p class="settings-hint" style="margin-bottom: 1rem;">            Videos you reported are hidden from your feed until reviewed. You can unhide them here.          </p>          <div id="hiddenVideosList" class="settings-hint">            <div class="blocklist-placeholder">              <div class="blocklist-placeholder-title">No hidden videos yet</div>              <div class="blocklist-placeholder-sub">Reported videos will appear here so you can unhide them anytime.</div>            </div>          </div>        </div>        <!-- Danger Zone -->        <div class="settings-section danger-zone" data-section="danger">          <h2 class="settings-title">Danger Zone</h2>          <div class="settings-item">            <div>              <label class="settings-label">Delete Account</label>              <p class="settings-hint">Once you delete your account, there is no going back. All your videos and data will be permanently deleted.</p>            </div>            <button class="btn-danger" id="deleteAccountBtn">Delete Account</button>          </div>        </div>      </div>    </div>  </main>  <!-- Auth Modal -->  <div class="modal-overlay hidden" id="authModal">    <div class="modal">      <div class="modal-header">        <img src="assets/logo.png" alt="Mukkaz" class="modal-logo" onerror="this.style.display='none'">        <h2 class="modal-title" id="authModalTitle">Welcome to Mukkaz</h2>        <button class="modal-close" id="closeAuthModal">          <span id="closeIcon">
</span>        </button>      </div>      <p class="secondary" style="text-align: center; margin-bottom: 1.5rem; font-size: 0.95rem;">        Join the community and start sharing your videos today      </p>      <form class="auth-form" id="signInForm">        <div class="form-group">          <label class="form-label">Email</label>          <input type="email" class="form-input" id="signInEmail" required>        </div>        <div class="form-group">          <label class="form-label">Password</label>          <input type="password" class="form-input" id="signInPassword" required>        </div>        <button type="submit" class="btn-primary">Sign In</button>        <div class="auth-footer">          Don't have an account&bull;          <span class="auth-link" id="showSignUpBtn">Sign Up</span>        </div>      </form>      <form class="auth-form hidden" id="signUpForm">        <div class="form-group">          <label class="form-label">Username</label>          <input type="text" class="form-input" id="signUpUsername" required>        </div>        <div class="form-group">          <label class="form-label">Email</label>          <input type="email" class="form-input" id="signUpEmail" required>        </div>        <div class="form-group">          <label class="form-label">Password</label>          <input type="password" class="form-input" id="signUpPassword" required>        </div>        <button type="submit" class="btn-primary">Sign Up</button>        <div class="auth-footer">          Already have an account&bull;          <span class="auth-link" id="showSignInBtn">Sign In</span>        </div>      </form>    </div>  </div>  <!-- Delete Account Confirmation Modal -->  <div class="modal-overlay hidden" id="deleteAccountModal">    <div class="modal">      <div class="modal-header">        <h2 class="modal-title">Delete Account</h2>        <button class="modal-close" id="closeDeleteModal">          <span id="closeDeleteIcon">
</span>        </button>      </div>      <div style="padding: 1rem 0;">        <p style="margin-bottom: 1rem;">Are you absolutely sure you want to delete your account&bull;</p>        <p class="secondary" style="margin-bottom: 1rem;">          This action cannot be undone. This will permanently delete:        </p>        <ul style="list-style: disc; margin-left: 2rem; margin-bottom: 1rem;" class="secondary">          <li>Your profile and account information</li>          <li>All your uploaded videos</li>          <li>All your comments and likes</li>          <li>Your subscriptions and subscribers</li>        </ul>        <p style="margin-bottom: 1.5rem; color: var(--danger);">          Type your username (<strong id="confirmUsername">
</strong>) to confirm:        </p>        <form id="deleteAccountForm">          <div class="form-group">            <input type="text" class="form-input" id="deleteConfirmInput" placeholder="Enter your username" required>          </div>          <div class="form-actions" style="gap: 1rem;">            <button type="submit" class="btn-danger">Permanently Delete Account</button>            <button type="button" class="btn-secondary" id="cancelDeleteBtn">Cancel</button>          </div>        </form>      </div>    </div>  </div>  <!-- Scripts -->  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>  <script src="js/icons.js"></script>  <script src="js/utils.js"></script>  <script src="js/supabase.js"></script>  <script src="js/app.js"></script>  <script>    let currentUser = null;    let currentProfile = null;    document.addEventListener('DOMContentLoaded', async () => {      await initializeApp();      await loadProfile();      initializeSettingsHandlers();      initializeProfileTabs();      setupPayoutFields();    });    function initializeProfileTabs() {      /* Add icons to tabs*/
      document.getElementById('settingsIcon').innerHTML = getIcon('settings');      document.getElementById('statsIcon').innerHTML = getIcon('chart');      document.getElementById('earningsIcon').innerHTML = getIcon('dollar');      document.getElementById('privacyIcon').innerHTML = getIcon('lock');      document.getElementById('blockedIcon').innerHTML = getIcon('eyeOff');      const sections = document.querySelectorAll('.profile-settings > .settings-section');      const tabSections = {        settings: ['account'],        stats: ['stats'],        earnings: ['earnings'],        privacy: ['privacy', 'notifications', 'danger'],        blocked: ['blocked']      };      function renderTab(tabName) {        sections.forEach(section => {          section.style.display = 'none';        });        const showKeys = tabSections[tabName] || [];        sections.forEach(section => {          if (showKeys.includes(section.dataset.section)) {            section.style.display = 'block';          }        });      }      /* Ensure default tab only shows its sections on load.*/
      renderTab('settings');      /* Tab switching*/
      document.querySelectorAll('.profile-tab').forEach(tab => {        tab.addEventListener('click', () => {          const tabName = tab.dataset.tab;          /* Update active tab*/
          document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));          tab.classList.add('active');          renderTab(tabName);          if (tabName === 'blocked') {            loadHiddenVideos();          }        });      });    }    async function loadProfile() {      currentUser = await getCurrentUser();      if (!currentUser) {        const profileContainer = document.querySelector('.profile-container');        profileContainer.innerHTML = `          <div style="text-align: center; padding: 4rem 2rem; background-color: var(--bg-secondary); border-radius: 12px;">            <div style="font-size: 4rem; margin-bottom: 1rem;">${getIcon('user')}</div>            <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">Sign In to View Your Profile</h3>            <p class="secondary" style="margin-bottom: 2rem; font-size: 1.1rem;">              Create an account to manage your videos and profile            </p>            <button class="btn-primary" onclick="openModal()" style="font-size: 1.1rem; padding: 1rem 3rem;">              Sign In / Sign Up            </button>          </div>        `;        return;      }      try {        currentProfile = await getProfile(currentUser.id);        /* Load profile header*/
        document.getElementById('profileUsername').textContent = currentProfile.username;        document.getElementById('displayUsername').textContent = currentProfile.username;        document.getElementById('displayEmail').textContent = currentUser.email;        document.getElementById('confirmUsername').textContent = currentProfile.username;        /* Load avatar with loading state*/
        const avatarImg = document.getElementById('profileAvatar');        const avatarContainer = document.getElementById('profileAvatarContainer');        avatarImg.onload = () => {          avatarImg.classList.add('loaded');          avatarContainer.classList.remove('loading');        };        avatarImg.src = currentProfile.avatar_url;        applyAvatarBadge(avatarContainer, currentProfile);        document.getElementById('joinedDate').textContent = timeSince(currentProfile.created_at);        /* Load profile information        // Load privacy settings from localStorage*/
        loadPrivacySettings();        loadNotificationSettings();        /* Load statistics*/
        await loadStatistics();        await loadEarnings();        await loadHiddenVideos();      } catch (error) {        console.error('Error loading profile:', error);        showNotification('Error loading profile', 'error');      }    }    async function loadHiddenVideos() {      const container = document.getElementById('hiddenVideosList');      if (!container) return;      const hiddenIds = getHiddenVideoIds();      if (!hiddenIds.length) {        container.innerHTML = `<div class="blocklist-placeholder">              <div class="blocklist-placeholder-title">No hidden videos yet</div>              <div class="blocklist-placeholder-sub">Reported videos will appear here so you can unhide them anytime.</div>            </div>`;        return;      }      container.textContent = 'Loading hidden videos...';      try {        const { data: videos, error } = await supabaseClient          .from('videos')          .select('id, title, thumbnail_url, created_at')          .in('id', hiddenIds);        if (error) throw error;        if (!videos || videos.length === 0) {          container.innerHTML = `<div class="blocklist-placeholder">              <div class="blocklist-placeholder-title">No hidden videos yet</div>              <div class="blocklist-placeholder-sub">Reported videos will appear here so you can unhide them anytime.</div>            </div>`;          return;        }        const rows = videos.map(video => `          <div style="display: flex; gap: 1rem; padding: 0.75rem 0; border-bottom: 1px solid rgba(255,255,255,0.08); align-items: center;">            <img src="${escapeHtml(video.thumbnail_url || '')}" alt="${escapeHtml(video.title || '')}" style="width: 96px; height: 54px; object-fit: cover; border-radius: 6px; background: #111;" onerror="this.style.display='none'">            <div style="flex: 1; min-width: 0;">              <div style="font-weight: 600; font-size: 0.95rem;">${escapeHtml(video.title || 'Untitled video')}</div>              <div class="settings-hint">Hidden after report • ${timeSince(video.created_at)} ago</div>            </div>            <button class="btn-secondary btn-sm" onclick="unhideHiddenVideo('${video.id}')">Unhide</button>          </div>        `).join('');        container.innerHTML = rows;      } catch (error) {        console.error('Error loading hidden videos:', error);        container.textContent = 'Failed to load hidden videos.';      }    }    function unhideHiddenVideo(videoId) {      unhideReportedVideo(videoId);      showNotification('Video unhidden', 'success');      loadHiddenVideos();    }    async function loadStatistics() {      try {        const allVideos = await getVideos();        const myVideos = allVideos.filter(v => v.user_id === currentUser.id);        const totalViews = myVideos.reduce((sum, v) => sum + (v.views_count || 0), 0);        const totalLikes = myVideos.reduce((sum, v) => sum + (v.likes_count || 0), 0);        const totalVideos = myVideos.length;        const totalSubscribers = 0;        document.getElementById('videoCount').textContent = `${totalVideos} video${totalVideos !== 1 ? 's' : ''}`;        document.getElementById('totalViews').textContent = `${formatNumber(totalViews)} views`;        setStatsGraphData({          views: {            label: 'Total Views',            value: totalViews,            data: buildTrend(totalViews)          },          likes: {            label: 'Total Likes',            value: totalLikes,            data: buildTrend(totalLikes)          },          videos: {            label: 'Videos Uploaded',            value: totalVideos,            data: buildTrend(totalVideos)          },          subs: {            label: 'Subscribers',            value: totalSubscribers,            data: buildTrend(totalSubscribers)          }        });      } catch (error) {        console.error('Error loading statistics:', error);      }    }    let statsGraphData = {};    function buildTrend(total, points = 12) {      const safeTotal = Number(total) || 0;      if (points <= 1) return [safeTotal];      const data = [];      for (let i = 0; i < points; i += 1) {        const progress = i / (points - 1);        const wobble = Math.sin(i * 1.3) * 0.08;        const value = Math.round(safeTotal * Math.min(1, Math.max(0, progress + wobble)));        data.push(value);      }      return data;    }    function setStatsGraphData(data) {      statsGraphData = data || {};      const firstKey = document.querySelector('.stats-pill.active')?.dataset.stat || 'views';      updateStatsGraph(firstKey);      bindStatsGraphPills();    }    function bindStatsGraphPills() {      const pills = document.querySelectorAll('.stats-pill');      pills.forEach(pill => {        if (pill.dataset.bound) return;        pill.dataset.bound = 'true';        pill.addEventListener('click', () => {          pills.forEach(btn => btn.classList.remove('active'));          pill.classList.add('active');          updateStatsGraph(pill.dataset.stat);        });      });    }    function updateStatsGraph(key) {      const graph = statsGraphData[key];      if (!graph) return;      const title = document.getElementById('statsGraphTitle');      const value = document.getElementById('statsGraphValue');      const chart = document.getElementById('statsGraphChart');      const sub = document.getElementById('statsGraphSub');      if (title) title.textContent = graph.label;      if (value) value.textContent = formatNumber(graph.value);      if (sub) sub.textContent = 'Last 12 updates';      if (chart) chart.innerHTML = renderSparkline(graph.data);    }    function renderSparkline(values) {      if (!values || values.length === 0) return '';      const width = 100;      const height = 36;      const padding = 2;      const min = Math.min(...values);      const max = Math.max(...values);      const range = max - min || 1;      const points = values.map((value, index) => {        const x = padding + (index / (values.length - 1)) * (width - padding * 2);        const y = height - padding - ((value - min) / range) * (height - padding * 2);        return `${x.toFixed(2)},${y.toFixed(2)}`;      }).join(' ');      const firstPoint = points.split(' ')[0];      const lastPoint = points.split(' ')[points.split(' ').length - 1];      const areaPath = `M ${firstPoint} L ${points} L ${lastPoint.split(',')[0]},${height - padding} L ${firstPoint.split(',')[0]},${height - padding} Z`;      return `        <svg viewBox="0 0 ${width} ${height}" preserveAspectRatio="none" aria-hidden="true">          <path d="${areaPath}" fill="rgba(255, 42, 42, 0.18)"></path>          <polyline points="${points}" fill="none" stroke="#ff2a2a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></polyline>        </svg>      `;    }    async function loadEarnings() {      try {        const summary = await getEarningsSummary();        const payouts = await getPayoutRequests();        const eligibleViews = summary?.eligible_views || 0;        const totalEarned = summary?.earnings_jmd || 0;        const paidOut = summary?.paid_jmd || 0;        const pending = (payouts || []).filter(p => p.status === 'pending')          .reduce((sum, p) => sum + Number(p.amount_jmd || 0), 0);        const available = Math.max(totalEarned - paidOut - pending, 0);        document.getElementById('earningsViews').textContent = formatNumber(eligibleViews);        document.getElementById('earningsTotal').textContent = formatCurrencyJMD(totalEarned);        document.getElementById('earningsPaid').textContent = formatCurrencyJMD(paidOut);        document.getElementById('earningsAvailable').textContent = formatCurrencyJMD(available);        updateEarningsHero({          views: eligibleViews,          total: totalEarned,          paid: paidOut,          pending,          available        });        const progressPct = Math.min((totalEarned / 1000) * 100, 100);        document.getElementById('earningsProgressBar').style.width = `${progressPct}%`;        document.getElementById('earningsProgressText').textContent = `${formatCurrencyJMD(totalEarned)} / ${formatCurrencyJMD(1000)}`;        const payoutBtn = document.getElementById('requestPayoutBtn');        const payoutHint = document.getElementById('payoutHint');        const canRequest = available >= 1000;        payoutBtn.disabled = !canRequest;        payoutHint.textContent = canRequest          ? `Available to request: ${formatCurrencyJMD(available)}`          : 'Need JMD 1,000 earned to request a payout.';        renderPayoutRequests(payouts);        setupPayoutHandler(canRequest);        if (!window.earningsRefreshTimer) {          window.earningsRefreshTimer = setInterval(loadEarnings, 30000);        }      } catch (error) {        console.error('Error loading earnings:', error);        showNotification('Error loading earnings', 'error');      }    }    let earningsHeroState = null;    function updateEarningsHero(data) {      earningsHeroState = data;      const pills = document.querySelectorAll('.earnings-pill');      const activeKey = document.querySelector('.earnings-pill.active')?.dataset.key || 'available';      setEarningsHero(activeKey);      pills.forEach(pill => {        if (pill.dataset.bound) return;        pill.dataset.bound = 'true';        pill.addEventListener('click', () => {          pills.forEach(btn => btn.classList.remove('active'));          pill.classList.add('active');          setEarningsHero(pill.dataset.key);        });      });      updateEarningsBar();    }    function setEarningsHero(key) {      if (!earningsHeroState) return;      const badge = document.getElementById('earningsHeroBadge');      const value = document.getElementById('earningsHeroValue');      const sub = document.getElementById('earningsHeroSub');      if (!badge || !value || !sub) return;      if (key === 'views') {        badge.textContent = 'Eligible Views';        value.textContent = formatNumber(earningsHeroState.views);        sub.textContent = '2 views = JMD $1';        return;      }      if (key === 'total') {        badge.textContent = 'Total Earned';        value.textContent = formatCurrencyJMD(earningsHeroState.total);        sub.textContent = `${formatNumber(earningsHeroState.views)} eligible views`;        return;      }      if (key === 'paid') {        badge.textContent = 'Paid Out';        value.textContent = formatCurrencyJMD(earningsHeroState.paid);        sub.textContent = 'Approved payouts';        return;      }      badge.textContent = 'Available';      value.textContent = formatCurrencyJMD(earningsHeroState.available);      sub.textContent = earningsHeroState.pending > 0        ? `${formatCurrencyJMD(earningsHeroState.pending)} pending`        : 'Ready to request';    }    function updateEarningsBar() {      if (!earningsHeroState) return;      const total = earningsHeroState.total || 0;      const paid = earningsHeroState.paid || 0;      const pending = earningsHeroState.pending || 0;      const available = Math.max((earningsHeroState.available || 0), 0);      const denom = total > 0 ? total : Math.max(paid + pending + available, 1);      document.getElementById('earningsBarPaid').style.width = `${(paid / denom) * 100}%`;      document.getElementById('earningsBarPending').style.width = `${(pending / denom) * 100}%`;      document.getElementById('earningsBarAvailable').style.width = `${(available / denom) * 100}%`;    }    function renderPayoutRequests(requests) {      const container = document.getElementById('payoutRequestsList');      if (!requests || requests.length === 0) {        container.textContent = 'No payout requests yet.';        return;      }      container.innerHTML = requests.map(req => `        <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid rgba(255,255,255,0.08);">          <div>            <strong>${formatCurrencyJMD(req.amount_jmd)}</strong>            <div class="settings-hint">${req.method} · ${new Date(req.created_at).toLocaleDateString()}</div>          </div>          <span class="badge ${req.status === 'approved' ? 'badge-success' : req.status === 'rejected' ? 'badge-danger' : 'badge-warning'}">${req.status}</span>        </div>      `).join('');    }    function setupPayoutHandler(canRequest) {      const payoutBtn = document.getElementById('requestPayoutBtn');      if (!payoutBtn || payoutBtn.dataset.bound) return;      payoutBtn.dataset.bound = 'true';      payoutBtn.addEventListener('click', async () => {        if (!canRequest) return;        const method = document.getElementById('payoutMethod').value;        const details = getPayoutDetails(method);        if (!details) {          showNotification('Complete payout details', 'error');          return;        }        try {          payoutBtn.disabled = true;          await requestPayout(method, details);          showNotification('Payout request submitted', 'success');          clearPayoutFields();          await loadEarnings();        } catch (error) {          console.error('Error requesting payout:', error);          showNotification(error.message || 'Failed to request payout', 'error');          payoutBtn.disabled = false;        }      });    }    function setupPayoutFields() {      const methodSelect = document.getElementById('payoutMethod');      if (!methodSelect) return;      const update = () => {        const method = methodSelect.value;        document.querySelectorAll('.payout-field').forEach(field => {          if (field.dataset.method === method) {            field.style.display = 'block';          } else {            field.style.display = 'none';          }        });      };      methodSelect.addEventListener('change', update);      update();    }    function getPayoutDetails(method) {      if (method === 'lynk') {        const id = document.getElementById('payoutLynkId').value.trim();        if (!id) return '';        return `Lynk ID: ${id}`;      }      if (method === 'crypto') {        const type = document.getElementById('payoutCryptoType').value;        const address = document.getElementById('payoutCryptoAddress').value.trim();        if (!address) return '';        return `Crypto: ${type} | Address: ${address}`;      }      if (method === 'bank') {        const type = document.getElementById('payoutBankType').value;        const branch = document.getElementById('payoutBankBranch').value.trim();        const account = document.getElementById('payoutBankAccount').value.trim();        if (!branch || !account) return '';        return `Bank: ${type} | Branch: ${branch} | Account: ${account}`;      }      return '';    }    function clearPayoutFields() {      const lynk = document.getElementById('payoutLynkId');      const crypto = document.getElementById('payoutCryptoAddress');      const bankBranch = document.getElementById('payoutBankBranch');      const bankAccount = document.getElementById('payoutBankAccount');      if (lynk) lynk.value = '';      if (crypto) crypto.value = '';      if (bankBranch) bankBranch.value = '';      if (bankAccount) bankAccount.value = '';    }    function formatCurrencyJMD(amount) {      const value = Number(amount) || 0;      return `JMD ${value.toFixed(0)}`;    }    function initializeSettingsHandlers() {      /* Avatar upload*/
      document.getElementById('editAvatarBtn').addEventListener('click', () => {        document.getElementById('avatarInput').click();      });      document.getElementById('avatarInput').addEventListener('change', handleAvatarUpload);      /* Username editing*/
      document.getElementById('editUsernameBtn').addEventListener('click', () => toggleEditForm('username'));      document.getElementById('cancelUsernameBtn').addEventListener('click', () => toggleEditForm('username'));      document.getElementById('usernameForm').addEventListener('submit', handleUsernameUpdate);      /* Email editing*/
      document.getElementById('editEmailBtn').addEventListener('click', () => toggleEditForm('email'));      document.getElementById('cancelEmailBtn').addEventListener('click', () => toggleEditForm('email'));      document.getElementById('emailForm').addEventListener('submit', handleEmailUpdate);      /* Password changing*/
      document.getElementById('editPasswordBtn').addEventListener('click', () => toggleEditForm('password'));      document.getElementById('cancelPasswordBtn').addEventListener('click', () => toggleEditForm('password'));      document.getElementById('passwordForm').addEventListener('submit', handlePasswordUpdate);      /* Privacy settings*/
      document.getElementById('profileVisibilityCheck').addEventListener('change', savePrivacySettings);      document.getElementById('showEmailCheck').addEventListener('change', savePrivacySettings);      document.getElementById('matureContentCheck').addEventListener('change', savePrivacySettings);      /* Notification settings*/
      document.getElementById('notifySubscribersCheck').addEventListener('change', saveNotificationSettings);      document.getElementById('notifyCommentsCheck').addEventListener('change', saveNotificationSettings);      document.getElementById('notifyLikesCheck').addEventListener('change', saveNotificationSettings);      document.getElementById('notifyUploadsCheck').addEventListener('change', saveNotificationSettings);      /* Delete account*/
      document.getElementById('deleteAccountBtn').addEventListener('click', openDeleteAccountModal);      document.getElementById('closeDeleteModal').addEventListener('click', closeDeleteAccountModal);      document.getElementById('cancelDeleteBtn').addEventListener('click', closeDeleteAccountModal);      document.getElementById('deleteAccountForm').addEventListener('submit', handleDeleteAccount);      /* Add icons*/
      document.getElementById('editIcon').innerHTML = getIcon('edit');      document.getElementById('closeDeleteIcon').innerHTML = getIcon('close');    }    function toggleEditForm(type) {      const form = document.getElementById(`${type}Form`);      const header = form.previousElementSibling;      if (form.classList.contains('hidden')) {        form.classList.remove('hidden');        header.style.display = 'none';        if (type === 'username') {          document.getElementById('newUsername').value = currentProfile.username;          document.getElementById('newUsername').focus();        } else if (type === 'email') {          document.getElementById('newEmail').value = currentUser.email;          document.getElementById('newEmail').focus();        } else if (type === 'password') {          document.getElementById('currentPassword').focus();        }      } else {        form.classList.add('hidden');        header.style.display = '';        form.reset();      }    }    async function handleAvatarUpload(e) {      const file = e.target.files[0];      if (!file) return;      const maxSize = 5 * 1024 * 1024; /* 5MB*/
      if (file.size > maxSize) {        showNotification('Avatar must be less than 5MB', 'error');        return;      }      try {        showNotification('Uploading avatar...', 'info');        const avatarUrl = await uploadAvatar(file);        document.getElementById('profileAvatar').src = avatarUrl;        currentProfile.avatar_url = avatarUrl;        showNotification('Avatar updated successfully', 'success');      } catch (error) {        console.error('Error uploading avatar:', error);        showNotification('Error uploading avatar', 'error');      }    }    async function handleUsernameUpdate(e) {      e.preventDefault();      const newUsername = document.getElementById('newUsername').value.trim();      if (newUsername === currentProfile.username) {        toggleEditForm('username');        return;      }      if (newUsername.length < 3) {        showNotification('Username must be at least 3 characters', 'error');        return;      }      try {        showNotification('Updating username...', 'info');        const { error } = await supabaseClient          .from('profiles')          .update({ username: newUsername })          .eq('id', currentUser.id);        if (error) throw error;        currentProfile.username = newUsername;        document.getElementById('profileUsername').textContent = newUsername;        document.getElementById('displayUsername').textContent = newUsername;        document.getElementById('confirmUsername').textContent = newUsername;        toggleEditForm('username');        showNotification('Username updated successfully', 'success');      } catch (error) {        console.error('Error updating username:', error);        /* Check if it's a conflict error (username already taken)*/
        if (error.code === '23505' || error.message?.includes('duplicate') || error.message?.includes('unique')) {          showNotification('Username already taken. Please choose another one.', 'error');        } else {          showNotification(error.message || 'Error updating username', 'error');        }      }    }    async function handleEmailUpdate(e) {      e.preventDefault();      const newEmail = document.getElementById('newEmail').value.trim();      if (newEmail === currentUser.email) {        toggleEditForm('email');        return;      }      try {        showNotification('Updating email...', 'info');        const { error } = await supabaseClient.auth.updateUser({          email: newEmail        });        if (error) throw error;        showNotification('Check your new email to confirm the change', 'success');        toggleEditForm('email');      } catch (error) {        console.error('Error updating email:', error);        showNotification(error.message || 'Error updating email', 'error');      }    }    async function handlePasswordUpdate(e) {      e.preventDefault();      const newPassword = document.getElementById('newPassword').value;      const confirmPassword = document.getElementById('confirmPassword').value;      if (newPassword !== confirmPassword) {        showNotification('Passwords do not match', 'error');        return;      }      if (newPassword.length < 6) {        showNotification('Password must be at least 6 characters', 'error');        return;      }      try {        showNotification('Updating password...', 'info');        const { error } = await supabaseClient.auth.updateUser({          password: newPassword        });        if (error) throw error;        toggleEditForm('password');        showNotification('Password updated successfully', 'success');      } catch (error) {        console.error('Error updating password:', error);        showNotification(error.message || 'Error updating password', 'error');      }    }    async function handleBioSave() {      const bio = document.getElementById('bioInput').value.trim();      try {        showNotification('Saving bio...', 'info');        const { error } = await supabaseClient          .from('profiles')          .update({ bio })          .eq('id', currentUser.id);        if (error) throw error;        currentProfile.bio = bio;        showNotification('Bio saved successfully', 'success');      } catch (error) {        console.error('Error saving bio:', error);        showNotification('Error saving bio', 'error');      }    }    async function handleLocationSave() {      const location = document.getElementById('locationInput').value.trim();      try {        showNotification('Saving location...', 'info');        const { error } = await supabaseClient          .from('profiles')          .update({ location })          .eq('id', currentUser.id);        if (error) throw error;        currentProfile.location = location;        showNotification('Location saved successfully', 'success');      } catch (error) {        console.error('Error saving location:', error);        showNotification('Error saving location', 'error');      }    }    async function handleWebsiteSave() {      const website = document.getElementById('websiteInput').value.trim();      try {        showNotification('Saving website...', 'info');        const { error } = await supabaseClient          .from('profiles')          .update({ website })          .eq('id', currentUser.id);        if (error) throw error;        currentProfile.website = website;        showNotification('Website saved successfully', 'success');      } catch (error) {        console.error('Error saving website:', error);        showNotification('Error saving website', 'error');      }    }    function loadPrivacySettings() {      const settings = JSON.parse(localStorage.getItem('privacySettings') || '{}');      document.getElementById('profileVisibilityCheck').checked = settings.profilePublic !== false;      document.getElementById('showEmailCheck').checked = settings.showEmail === true;      document.getElementById('matureContentCheck').checked = settings.showMatureContent !== false;    }    function savePrivacySettings() {      const settings = {        profilePublic: document.getElementById('profileVisibilityCheck').checked,        showEmail: document.getElementById('showEmailCheck').checked,        showMatureContent: document.getElementById('matureContentCheck').checked      };      localStorage.setItem('privacySettings', JSON.stringify(settings));      showNotification('Privacy settings saved', 'success');    }    function loadNotificationSettings() {      const settings = JSON.parse(localStorage.getItem('notificationSettings') || '{}');      document.getElementById('notifySubscribersCheck').checked = settings.notifySubscribers !== false;      document.getElementById('notifyCommentsCheck').checked = settings.notifyComments !== false;      document.getElementById('notifyLikesCheck').checked = settings.notifyLikes === true;      document.getElementById('notifyUploadsCheck').checked = settings.notifyUploads !== false;    }    function saveNotificationSettings() {      const settings = {        notifySubscribers: document.getElementById('notifySubscribersCheck').checked,        notifyComments: document.getElementById('notifyCommentsCheck').checked,        notifyLikes: document.getElementById('notifyLikesCheck').checked,        notifyUploads: document.getElementById('notifyUploadsCheck').checked      };      localStorage.setItem('notificationSettings', JSON.stringify(settings));      showNotification('Notification settings saved', 'success');    }    function openDeleteAccountModal() {      document.getElementById('deleteAccountModal').classList.remove('hidden');    }    function closeDeleteAccountModal() {      document.getElementById('deleteAccountModal').classList.add('hidden');      document.getElementById('deleteConfirmInput').value = '';    }    async function handleDeleteAccount(e) {      e.preventDefault();      const confirmInput = document.getElementById('deleteConfirmInput').value.trim();      if (confirmInput !== currentProfile.username) {        showNotification('Username does not match', 'error');        return;      }      try {        showNotification('Deleting account...', 'info');        /* Delete all user's videos first*/
        const allVideos = await getVideos();        const myVideos = allVideos.filter(v => v.user_id === currentUser.id);        for (const video of myVideos) {          await supabaseClient            .from('videos')            .delete()            .eq('id', video.id);        }        /* Delete profile*/
        await supabaseClient          .from('profiles')          .delete()          .eq('id', currentUser.id);        /* Delete auth user*/
        const { error } = await supabaseClient.auth.admin.deleteUser(currentUser.id);        if (error) throw error;        /* Sign out*/
        await supabaseClient.auth.signOut();        showNotification('Account deleted successfully', 'success');        window.location.href = 'index.html';      } catch (error) {        console.error('Error deleting account:', error);        showNotification('Error deleting account. Please contact support.', 'error');      }    }  </script>  <!-- Ads removed -->
</body>
</html>